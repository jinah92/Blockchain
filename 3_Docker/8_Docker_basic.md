# (Day 8) Docker 개념

## 1. 개요

---

Docker
- 2013년 Docker,Inc에서 출시한 오픈 소스 컨테이너 프로젝트

### 서비스 운영환경과 Docker

---

- 2010년을 넘어서며 서버 시장은 클라우드 환경으로 옮겨짐
- 과거 : 물리 서버를 직접 운영
    - 호스팅 또는 IDC 코로레이션 서비스를 사용
    - 서버 구입과 설치에 많은 비용과 시간 소모
- 가상화가 발전하며 **클라우드 서비스**로 변화
    - 가상 서버를 **임대하여 사용한 만큼만 비용 지불**
- 하지만, 클라우드 환경에서는 설치와 배포가 어려웠음
    - 서버 개수가 많아지며, 서버에 각종 sw를 설치 및 설정하는 것이 사람이 직접 하기가 어려움
    - 리눅스/유닉스 환경에서 셸 스크립트로 설치/설정 자동화를 해도 여전히 한계가 있음
    - 셸 스크립트의 단점 : 중앙관리, 복잡한 기능 구현 어려움
    - 리눅스의 단점 : 설치해야 할 응용프로그램이 많고, 설정이 복잡함

### Immutable(불가변) Infrastructure

---

Docker는 Immutable Infrastructure를 구현한 프로젝트

- **호스트 OS와 서비스 운영환경(서버 프로그램, 소스코드, 컴파일된 바이너리)을 분리**하고, **한번 설정한 운영 환경은 변경하지 않음(Immutable)**
- 서비스 운영 환경을 **이미지로 생성 후 서버에 배포**하여 실행
- 서비스 업데이트 ⇒ 이미지를 새로 생성하여 배포 (운영환경을 변경 X)

[장점](https://www.notion.so/2ad08f2057a74d37b73e8edc1cc911a0)

- 클라우드 서비스 : 가상화 기술을 이용하여 서버를 임대해주는 서비스

### 가상머신 계층도

---

![Day%208%20Docker/Untitled.png](images/Day%208%20Docker/Untitled.png)

### 가상머신의 문제점

---

- 전체 컴퓨터를 만듦에 따라 각종 손실이 발생 **( = 항상 게스트 OS를 설치해야 함)**
- 인텔과 AMD ⇒ CPU 안에 가상화 기능을 넣기 시작 (하지만 여전히 느림)
- 이미지 안에 OS가 포함 ⇒ **이미지 용량의 증가**
(네트워크로 가상화 이미지를 주고 받는 것은 꽤나 부담스러운 일)
- OS 가상화에만 주력 ⇒ **배포, 관리 기능이 부족함**
- **반 가상화(Paravirtualization) 기술**  : 전가상화(Full Virtualization)의 느린 속도를 개선하기 위해 개발됨 / 호스트와 커널을 공유
- 가상머신의 성능 문제에 따라, 리눅스 컨테이너가 등장

    ![Day%208%20Docker/Untitled%201.png](images/Day%208%20Docker/Untitled%201.png)

## 2. Docker

---

- Dokcer는 리눅스 컨테이너를 사용
    - 초기 : LXC를 기반으로 구현
    - 버전 0.9부터는 LXC를 대신하는 libcontatiner를 개발하여 사용
    - 실행 옵션으로 선택 가능

    **LXC (리눅스 컨테이너)**
        1. 컨테이너 안에 가상 공간을 만들지만, 실행 파일을 호스트에서 직접 실행
        2. 리눅스 커널의 cgroups와 namespaces가 제공하는 기술
        3. 가상화가 아닌, 격리

### 특징

---

1. **게스트 OS를 설치하지 않음**
    - 이미지에 서버 운영을 위한 프로그램과 라이브러리만 격리해서 설치
    - 이미지 용량이 크게 줄어들음
    - 호스트와 OS 차원(시스템 콜)을 사용

        ![Day%208%20Docker/Untitled%202.png](images/Day%208%20Docker/Untitled%202.png)

2. **하드웨어 가상화 계층이 없음**
    - 메모리 접근, 파일 시스템, 네트워크 전송 속도가 가상머신에 비해 월등히 빠름
    - 호스트와 도커 컨테이너 사이의 성능 차이가 크지 않음

3. **이미지 생성 및 배포에 특화** 
4. **이미지 버전 관리 제공, 중앙 저장소에 이미지를 올리고 받을 수 있음 (push, pull)**
5. Docker 이미지를 공유할 수 있는 **Dock Hub를 제공 (GitHub처럼 유료 개인 저장소도 제공)**
6. **다양한 API를 제공** ⇒ 원하는 만큼 자동화 가능, 개발 및 서버 운영에 매우 유용

### 도커 이미지와 컨테이너 차이

---

- **이미지 (실행 파일)**
    - 서비스 운영에 필요한 서버 프로그램, 소스 코드, 컴파일된 실행 파일을 묶은 형태
    - 저장소에 올리고 받는 것 (push, pull)
- **컨테이너 (프로세스)**
    - 이미지를 실행한 형태

이미지로 여러 개의 컨테이너를 만들 수 있음

### 도커의 이미지 처리 방식

---

- 유니온 파일 시스템
- 베이스 이미지에서 **바뀐 부분만 이미지로 생성 (해쉬)**
(Docker Hub 및 개인저장소에서 이미지 공유시, 바뀐 부분만 주고 받음)
- 컨테이너로 실행할 때는, **베이스 이미지 + 바뀐 부분을 합쳐서(Union) 실행**

![Day%208%20Docker/Untitled%203.png](images/Day%208%20Docker/Untitled%203.png)