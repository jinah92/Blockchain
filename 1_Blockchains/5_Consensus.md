# (Day 5) 합의 알고리즘

# 1. 합의 알고리즘

## 1.1. 개념

- 비잔틴 장군 문제를 해결함으로써, 네트워크에 악의적인 노드가 존재하더라도 **신뢰도 있는 시스템 제공**을 보장

## 1.2. 작업증명 (PoW)

- 1993년 신시아 도크와 모니 나오에 의해 제안된 개념
- 서비스 거부 공격이나 스팸 등으로 서비스가 남용되는 것을 방지하기 위해 만들어진 기법
- 서비스를 신청하는 자에게 작지 않으면서도 처리 가능한 수준의 과제를 요구 (예: CAPCHA)
- 1999년 마르크스 야콥슨과 아리 쥬얼이 쓴 논문에서 처음으로 등장
- 사토시 나카모토가 처음으로 제안한 비잔틴 합의 알고리즘 ⇒ **Nonce를 찾는 과정**
- **작업(계산) 능력에 의해 채굴 능력(확률)이 결정**
- 단점 : 느린 속도, 에너지 낭비 문제

## 1.3. 지분증명 (PoS)

- 가상화폐 PeerCoin에서 처음으로 발표한 합의 알고리즘
- **지분과 지분이 생성된 날짜에 의해 채굴 능력(확률)이 결정**
- 작업증명 알고리즘의 에너지 낭비 문제를 해결
- 다양한 알고리즘 존재

# 2. 보상

- 새로운 블록을 블록체인에 추가해 블록에 포함된 모든 거래를 유효한 거래로 확정시켜준 **대가**
- 비트코인에서의 보상은 새로 발행되는 비트코인과 해당 블록에 포함되는 거래의 거래 수수료의 합

# 3. 비트코인의 새로운 발행

- 채굴자가 블록을 처음 구성할 때, 채굴자의 지갑으로 일정량의 비트코인이 입금되는 거래를 그 블록의 첫 거래(generation transaction)로 추가하는 방식
- 새로 발행되는 비트코인은 최초의 50BTC에서 시작, 21만개의 블록 추가시 마다 절반으로 줄어듬

# 4. 트랜잭션 수수료

- 모든 트랜잭션은 수수료를 지불
- 트랜잭션 당사자끼리 자율적으로 정의함
- 비트코인 코어 V0.12 이전에는 트랜잭션 수수료를 지불하지 않고 거래하는  방법이 존재했었음
- 수수료율 = 트랜잭션 수수료 / 트랜잭션 크기(byte) ⇒ 채굴 우선순위 결정에 사용

# 5. 네트워크

- 노드들은 **항상 가장 긴 체인을 옳은 것으로 간주**
- 일시적으로 분기가 발생하더라도 이후 3~5개 블록이 추가되는 과정에서 분기 상태가 해소되고, 하나의 블록체인을 유지
- 채택되지 않은 블록에 포함된 거래는 다시 블록체인에 포함되지 않은 다른 거래들과 동일하게 취급되어 블록에 추가

# 작업증명(PoW, Proof of Work)

- 블록체인의 가장 기본적인 합의 알고리즘
- 거래승인 과정에 많은 컴퓨팅 파워가 필요한 어려운 작업을 수행 (nonce, difficulty)
- 가장 긴 블록체인을 합의하고, 다른 기록은 폐기
- 비트코인, 이더리움 Frontier, Homestead, Metropolis

**장점**
- 참가자 수에 영향을 받지 않고 얼마든지 참가자를 늘릴 수 있음
**단점**
- 네트워크 상태에 따라 일부분에 불일치가 생길 경우 ⇒ 최종성(finality) 불확실
- 채굴의 집중화, 독점화
- 과도한 에너지 소비

# 지분증명(PoS, Proof of Stake)

- 대량 통화를 소유하고 있는 참가자는 그 통화 가치를 지키기 위해 시스템의 신뢰성을 손실하지 않을 것을 전제함
- 채굴 시스템에서 사용자의 소유 지분이 블록 생성권의 지분율을 나타냄
- fork가 발생했을 때, 더 많은 자산을 보유한 체인을 채택
- 이더리움의 4번째 단계인 'Serenity'에서 사용

**장점**
- 지분율이 높을수록 채굴 난이도가 낮아지므로 PoW에 비해 에너지 소비가 적음
- PoW에 비해 블록 생성주기가 짧고, 독점화를 막을 수 있음
**단점**
- 빈익부 부익빈 (지분율이 높은 사용자가 블록을 생성할 가능성이 높음)

# PBFT (Practical Byzantine Fault Tolerance)

- **프라이빗 블록체인**에서 사용 (Hyperledger Fabric v0.6이나 v1.0의 Orderer 서비스, R3 Corda의 Notary)
- 약속된 행동을 하지 않는 비잔틴 노드가 존재할 수 있는 **비동기 시스템**에서 해당 분산 시스템에 참여한 모든 노드가 성공적으로 합의를 이룰 수 있도록 개발된 합의 알고리즘
- 최종성(Finality)의 불확실성 및 성능 문제를 해결
    - 다수결로 의사결정 후, 블록 생성 → 블록의 분기가 발생하지 않음
    - 한번 확정된 블록은 변경되지 않음  → 최종성(Finality) 확보